---
title: "1/19 Update"
author: "Alisha Kalangara"
output:
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
here::i_am('Progress_Updates/1-19-update.Rmd')
knitr::opts_knit$set(root.dir=here::here())
knitr::opts_chunk$set(echo = TRUE)
```

```{r load objects, include=FALSE}
 county_pies <- readRDS(here::here("Exploratory_Analysis", "county_pies.rds"))
 state_pies <- readRDS(here::here("Exploratory_Analysis", "state_pies.rds"))
 
 NA_scatter <- readRDS(here::here("Exploratory_Analysis", "NA_scatter.rds"))
 
 age_prop_scatter <- readRDS(here::here("Exploratory_Analysis",
                                        "age_prop_scatter.rds"))
age_prop_scatter_MO <- readRDS(here::here("Exploratory_Analysis",
                                          "age_prop_scatter_MO.rds"))
age_prop_scatter_OR <- readRDS(here::here("Exploratory_Analysis",
                                          "age_prop_scatter_OR.rds"))
age_prop_scatter_TN <- readRDS(here::here("Exploratory_Analysis",
                                          "age_prop_scatter_TN.rds"))
age_prop_scatter_TX <- readRDS(here::here("Exploratory_Analysis",
                                          "age_prop_scatter_TX.rds"))
age_prop_scatter_CA <- readRDS(here::here("Exploratory_Analysis",
                                          "age_prop_scatter_CA.rds"))
age_prop_scatter_NY <- readRDS(here::here("Exploratory_Analysis",
                                          "age_prop_scatter_NY.rds"))
prop_cases <- readRDS(here::here("Processed_Data", "proportioned_cases.rds"))
```


**all code available [here](https://github.com/akalangara/EarlyWarningCovid)**

## Datasets Used So Far
* [United States COVID-19 Cases and Deaths by State over Time](https://data.cdc.gov/Case-Surveillance/United-States-COVID-19-Cases-and-Deaths-by-State-o/9mfq-cb36)
    * downloaded : 01/15/2021

* [COVID-19 Case Surveillance Public Use Data with Geography](https://data.cdc.gov/Case-Surveillance/COVID-19-Case-Surveillance-Public-Use-Data-with-Ge/n8mc-b4w4)
    * downloaded : 01/15/2021



## Data Characteristics and Decisions
### Inclusion / Exclusion Criteria
* Start date was selected to be 05/31/2021
* End date was selected to be 12/31/2021
* For some states, December data has not been fully entered
* Dropped the US territories and Washington DC
* NYC was separate from NY in state dataset, these were combined

### Missing or Repressed Data
* Repressed data is represented by NA, while data that was not obtained (not filled out on a form) is represented by 'Missing'. 
* Data that was denoted as 'Unknown' were filled out as Unknown.
* Cases from the day of 5/31 are excluded from generated proportions because county level data only has month specified so cases from 5/31 are indistinguishable from the rest of May.
* For county data, age group 'Missing' and 'NA' values were combined and ultimately dropped.



## Evaluating Missingness  
### County Data
```{r echo=FALSE}
county_pies$res_state
```
**There are a negligible number of cases at the county level where the state wasn't known**

```{r echo=FALSE}
county_pies$age_group
```
**There are relatively few cases at the county level that didn't document age group**

```{r echo=FALSE}
county_pies$death_yn
```
**A lot of the death data is not documented at the county level. I think we should pull this information from a separate dataset.**

### State Data
```{r echo=FALSE}
state_pies$conf_cases
```

```{r echo=FALSE}
state_pies$conf_death
```

**some states didn't list conf_death and conf_cases (cumulative counts), these were left empty**  
**for analysis these were transformed to NA**  
**only conf_death and conf_cases had NAs, rest of the variables (state, new_case, new_death, sub_date, time_interval) had complete information**  
  
  
  
## Proportioning Cases
* Variant proportion data is available for 2 wk periods
* The state level data gives us the number of cases for every 2 wk period but is not age stratified
* The county level data is age stratified but only gives the number of cases on a monthly basis
* We can apply the monthly distribution of cases per age group (at the county level) to the state level data to proportion the cases to age groups. This assumes that the distribution of cases per age group is the same for the 2 2 wk periods that make up a month.  

### Distribution of NAs Over Study Period (County Level Data)
```{r echo=FALSE}
NA_scatter
```
**There are states where for a month or several months, age group is not available (suppressed or missing)**  

### Case Age Group Distribution Over Time
#### All States
```{r echo=FALSE}
age_prop_scatter
```
#### Missouri
```{r, echo=FALSE}
age_prop_scatter_MO
```
#### Oregon
```{r echo=FALSE}
age_prop_scatter_OR
```
#### Tennessee
```{r echo=FALSE}
age_prop_scatter_TN
```
#### Texas
```{r echo=FALSE}
age_prop_scatter_TX
```
#### California
```{r echo=FALSE}
age_prop_scatter_CA
```
#### New York
```{r echo=FALSE}
age_prop_scatter_NY
```
  
**For the most part, the distribution of cases over the age groups does not seem to vary a lot. As a result, for state:month combinations that we don't have county case data on, it may be ok to use the distribution from the month before or after**  
  
  
  
## Current Dataset
```{r echo=FALSE, warning=FALSE, message=FALSE, error=FALSE}
library(dplyr)
library(kableExtra)
ds <- knitr::kable(x = head(prop_cases, 20), format = "html") %>%
     kable_paper("hover", full_width = T)
ds
```

